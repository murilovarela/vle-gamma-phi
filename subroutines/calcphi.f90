SUBROUTINE CALCPHI (A1, A2, X1, X2, B1, B2, Z1, Z2, ACUB1, BCUB1, ACUB2, BCUB2, PHI1, PHI2)
  REAL, INTENT(IN) :: A1, A2, X1, X2, B1, B2, Z1, Z2, ACUB1, BCUB1, ACUB2, BCUB2
  REAL, INTENT(OUT) :: PHI1, PHI2
  REAL :: A, B, PHI11, PHI12, PHI21, PHI22

  A = A1*X1**2 + 2*X1*X2*SQRT(A1*A2) + A2*X2**2
  B = X1*B1 + X2*B2

  PHI11 = -LOG(Z1-BCUB1) + (Z1-1)*B1/B - (ACUB1/(2*SQRT(2.0)*BCUB1))*((1/A)*(2*(X1*A1 + X2*SQRT(A1*A2))) - (B1/B))
  PHI12 = LOG((Z1 + (SQRT(2.0) + 1.0)*BCUB1)/(Z1-(SQRT(2.0) - 1.0)*BCUB1))
  PHI1 = EXP(PHI11*PHI12)

  PHI21 = -LOG(Z2-BCUB2) + (Z2-1)*B2/B - (ACUB2/(2*SQRT(2.0)*BCUB2))*((1/A)*(2*(X1*SQRT(A1*A2) + X2*A2)) - (B2/B))
  PHI22 = LOG((Z2 + (SQRT(2.0) + 1.0)*BCUB2)/(Z2-(SQRT(2.0) - 1.0)*BCUB2))
  PHI2 = EXP(PHI21*PHI22)
  RETURN
END SUBROUTINE CALCPHI
